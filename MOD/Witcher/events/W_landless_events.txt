namespace = landless

# Moving toward holding
# ROOT is the player
character_event = {
	id = landless.1
	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		location = {
			remove_province_modifier = prosperity_modifier_3
			
			# Find the neighboring province whose distance to target is smaller
			random_neighbor_province = {
				limit = {
					NOT = { terrain = magic_tower } # Messes up the distances
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 10 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 25 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 50 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 75 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 100 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 125 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 150 }
					}
				}	
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 200 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 250 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 300 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 350 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 400 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 450 }
					}
				}
				preferred_limit = {
					event_target:target_province = {
						distance = { where = PREV value < 500 }
					}
				}				
								
				
				holder_scope = {
					ROOT = {
						set_defacto_liege = PREV
						force_host = PREV # Move the location in UI
						# Note: force_host may result in different province than random_neighbor_province !
						location = {
							add_province_modifier = { name = prosperity_modifier_3 duration = -1} 
						}
					}
				}
			}
		}
	}
	
	option = {
		name = OK
		
		trigger = {
			location = {
				event_target:target_province = {
					province = PREV
				}
			}
		}
		# STOP
		remove_trait = travelling
	}
	
	option = {
		name = OK
		trigger = {
			location = {
				event_target:target_province = {
					NOT = { province = PREV }
				}
			}
		}
		# TODO make duration depend on terrain and climate
		repeat_event = { id = landless.1  days = 10 }
	}
}

narrative_event = {
	id = landless.3
	title = EVTTITLElandless.3
	desc = EVTDESClandless.3
	
	is_triggered_only = yes
	
	trigger = {
		is_landed = no
	}
	
	option = {
		name = OK
	}
}